{"ast":null,"code":"import _asyncToGenerator from\"/Users/konstantin/Documents/Study/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/Users/konstantin/Documents/Study/my-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/konstantin/Documents/Study/my-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/konstantin/Documents/Study/my-app/node_modules/@babel/runtime/regenerator/index.js\";import{usersAPI}from\"../../src/api/api\";import{updateObjectArray}from\"../utils/validators/object-helpers\";var SET_USERS='SET-USERS';var FOLLOW='FOLLOW';var UNFOLLOW='UNFOLLOW';var SET_CURRENT_PAGE='SET-CURRENT-PAGE';var SET_TOTAL_USERS_COUNT='SET-TOTAL-USERS-COUNT';var TOGGLE_IS_FETCHING='TOGGLE-IS-FETCHING';var TOGGLE_IS_FOLLOWING_IN_PROGRESS='TOGGLE-IS-FOLLOWING_IN_PROGRESS';var initialState={users:[],pageSize:10,totalUsersCount:0,currentPage:1,isFetching:false,followingInProgress:[]};var usersReducer=function usersReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case FOLLOW:return _objectSpread(_objectSpread({},state),{},{users:updateObjectArray(state.users,action.userid,'id',{followed:true})});case UNFOLLOW:return _objectSpread(_objectSpread({},state),{},{users:updateObjectArray(state.users,action.userid,'id',{followed:false})});case SET_USERS:{return _objectSpread(_objectSpread({},state),{},{users:action.users});}case SET_CURRENT_PAGE:{return _objectSpread(_objectSpread({},state),{},{currentPage:action.page});}case SET_TOTAL_USERS_COUNT:{return _objectSpread(_objectSpread({},state),{},{totalUsersCount:action.totalCount});}case TOGGLE_IS_FETCHING:{return _objectSpread(_objectSpread({},state),{},{isFetching:action.isFetching});}case TOGGLE_IS_FOLLOWING_IN_PROGRESS:{return _objectSpread(_objectSpread({},state),{},{followingInProgress:action.isFetching?[].concat(_toConsumableArray(state.followingInProgress),[action.userId]):state.followingInProgress.filter(function(id){return id!=action.userId;})});}default:return state;}};export var setUsers=function setUsers(users){return{type:SET_USERS,users:users};};export var followSuccess=function followSuccess(userid){return{type:FOLLOW,userid:userid};};export var unfollowSuccess=function unfollowSuccess(userid){return{type:UNFOLLOW,userid:userid};};export var setCurrentPage=function setCurrentPage(page){return{type:SET_CURRENT_PAGE,page:page};};export var setTotalUsersCount=function setTotalUsersCount(totalCount){return{type:SET_TOTAL_USERS_COUNT,totalCount:totalCount};};export var toggleIsFetching=function toggleIsFetching(isFetching){return{type:TOGGLE_IS_FETCHING,isFetching:isFetching};};export var toggleIsFollowingInProgress=function toggleIsFollowingInProgress(isFetching,userId){return{type:TOGGLE_IS_FOLLOWING_IN_PROGRESS,isFetching:isFetching,userId:userId};};export var requestUsers=function requestUsers(page,pageSize){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:debugger;dispatch(toggleIsFetching(true));dispatch(setCurrentPage(page));_context.next=5;return usersAPI.getUsers(page,pageSize);case 5:data=_context.sent;dispatch(toggleIsFetching(false));dispatch(setUsers(data.items));dispatch(setTotalUsersCount(data.totalCount));case 9:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};var followUnfollowFlow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch,userId,apiMethod,actionCreator){var data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch(toggleIsFollowingInProgress(true,userId));_context2.next=3;return apiMethod(userId);case 3:data=_context2.sent;if(data.resultCode==0){dispatch(actionCreator(userId));}dispatch(toggleIsFollowingInProgress(false,userId));case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function followUnfollowFlow(_x2,_x3,_x4,_x5){return _ref2.apply(this,arguments);};}();export var follow=function follow(userId){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:followUnfollowFlow(dispatch,userId,usersAPI.follow.bind(usersAPI),followSuccess);case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x6){return _ref3.apply(this,arguments);};}();};export var unfollow=function unfollow(userId){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:followUnfollowFlow(dispatch,userId,usersAPI.unfollow.bind(usersAPI),unfollowSuccess);case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x7){return _ref4.apply(this,arguments);};}();};export default usersReducer;","map":{"version":3,"sources":["/Users/konstantin/Documents/Study/my-app/src/redux/users-reducer.js"],"names":["usersAPI","updateObjectArray","SET_USERS","FOLLOW","UNFOLLOW","SET_CURRENT_PAGE","SET_TOTAL_USERS_COUNT","TOGGLE_IS_FETCHING","TOGGLE_IS_FOLLOWING_IN_PROGRESS","initialState","users","pageSize","totalUsersCount","currentPage","isFetching","followingInProgress","usersReducer","state","action","type","userid","followed","page","totalCount","userId","filter","id","setUsers","followSuccess","unfollowSuccess","setCurrentPage","setTotalUsersCount","toggleIsFetching","toggleIsFollowingInProgress","requestUsers","dispatch","getUsers","data","items","followUnfollowFlow","apiMethod","actionCreator","resultCode","follow","bind","unfollow"],"mappings":"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","sourcesContent":["import { usersAPI } from \"../../src/api/api\";\nimport { updateObjectArray } from \"../utils/validators/object-helpers\";\n\nconst SET_USERS = 'SET-USERS';\nconst FOLLOW = 'FOLLOW';\nconst UNFOLLOW = 'UNFOLLOW';\nconst SET_CURRENT_PAGE = 'SET-CURRENT-PAGE';\nconst SET_TOTAL_USERS_COUNT = 'SET-TOTAL-USERS-COUNT';\nconst TOGGLE_IS_FETCHING = 'TOGGLE-IS-FETCHING';\nconst TOGGLE_IS_FOLLOWING_IN_PROGRESS = 'TOGGLE-IS-FOLLOWING_IN_PROGRESS'\n\n\nlet initialState = {\n    users: [],\n    pageSize: 10,\n    totalUsersCount: 0,\n    currentPage: 1,\n    isFetching: false,\n    followingInProgress: [],\n}\n\nconst usersReducer = (state = initialState, action) => {\n    switch (action.type) {\n        case FOLLOW:\n            return {\n                ...state,\n                users: updateObjectArray(state.users, action.userid, 'id', { followed: true })\n            }\n        case UNFOLLOW:\n            return {\n                ...state,\n                users: updateObjectArray(state.users, action.userid, 'id', { followed: false })\n\n            }\n        case SET_USERS: {\n            return { ...state, users: action.users }\n        }\n        case SET_CURRENT_PAGE: {\n            return { ...state, currentPage: action.page }\n        }\n        case SET_TOTAL_USERS_COUNT: {\n            return { ...state, totalUsersCount: action.totalCount }\n        }\n        case TOGGLE_IS_FETCHING: {\n            return { ...state, isFetching: action.isFetching }\n        }\n        case TOGGLE_IS_FOLLOWING_IN_PROGRESS: {\n            return {\n                ...state, followingInProgress: action.isFetching\n                    ? [...state.followingInProgress, action.userId]\n                    : state.followingInProgress.filter(id => id != action.userId)\n            }\n        }\n        default:\n            return state;\n    }\n}\nexport const setUsers = (users) => ({ type: SET_USERS, users });\nexport const followSuccess = (userid) => ({ type: FOLLOW, userid });\nexport const unfollowSuccess = (userid) => ({ type: UNFOLLOW, userid });\nexport const setCurrentPage = (page) => ({ type: SET_CURRENT_PAGE, page });\nexport const setTotalUsersCount = (totalCount) => ({ type: SET_TOTAL_USERS_COUNT, totalCount });\nexport const toggleIsFetching = (isFetching) => ({ type: TOGGLE_IS_FETCHING, isFetching });\nexport const toggleIsFollowingInProgress = (isFetching, userId) => ({ type: TOGGLE_IS_FOLLOWING_IN_PROGRESS, isFetching, userId });\n\nexport const requestUsers = (page, pageSize) => async (dispatch) => {\n    debugger\n    dispatch(toggleIsFetching(true));\n    dispatch(setCurrentPage(page));\n    let data = await usersAPI.getUsers(page, pageSize)\n    dispatch(toggleIsFetching(false));\n    dispatch(setUsers(data.items));\n    dispatch(setTotalUsersCount(data.totalCount));\n}\nconst followUnfollowFlow = async (dispatch, userId, apiMethod, actionCreator) => {\n    dispatch(toggleIsFollowingInProgress(true, userId));\n    let data = await apiMethod(userId)\n    if (data.resultCode == 0) {\n        dispatch(actionCreator(userId));\n    }\n    dispatch(toggleIsFollowingInProgress(false, userId));\n}\nexport const follow = (userId) => async (dispatch) => {\n    followUnfollowFlow(dispatch, userId, usersAPI.follow.bind(usersAPI), followSuccess)\n}\nexport const unfollow = (userId) => async (dispatch) => {\n    followUnfollowFlow(dispatch, userId, usersAPI.unfollow.bind(usersAPI), unfollowSuccess)\n}\n\n\nexport default usersReducer;"]},"metadata":{},"sourceType":"module"}